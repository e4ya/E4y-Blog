@tailwind components;

@layer components {
    .card-base {
        @apply rounded-[var(--radius-large)] overflow-hidden transition;
        background-color: var(--card-bg);
    }
    
    /* Dynamic card opacity */
    :root {
        --card-bg-light-raw: 255, 255, 255;
        --card-bg-dark-raw: 0, 0, 0;
        --card-opacity-light: 0.85;
        --card-opacity-dark: 0.65;
    }
    
    :root:not(.dark) .card-base {
        background-color: rgba(var(--card-bg-light-raw), var(--card-opacity-light));
    }
    
    :root.dark .card-base {
        background-color: rgba(var(--card-bg-dark-raw), var(--card-opacity-dark));
    }
    h1, h2, h3, h4, h5, h6, p, a, span, li, ul, ol, blockquote, code, pre, table, th, td, strong {
        @apply transition;
    }
    .card-shadow {
        @apply drop-shadow-[0_2px_4px_rgba(0,0,0,0.005)]
    }
    .expand-animation {
        @apply relative before:ease-out before:transition active:bg-none hover:before:bg-[var(--btn-plain-bg-hover)] active:before:bg-[var(--btn-plain-bg-active)] z-0
        before:absolute before:rounded-[inherit] before:inset-0 before:scale-[0.85] hover:before:scale-100 before:-z-10
    }
    .link {
        @apply transition rounded-md p-1 -m-1 expand-animation;
    }
    .link-lg {
        @apply transition rounded-md p-1.5 -m-1.5 expand-animation;
    }
    .float-panel {
        @apply top-[5.25rem] rounded-[var(--radius-large)] overflow-hidden bg-[var(--float-panel-bg)] transition shadow-xl dark:shadow-none
    }
    .float-panel-closed {
        @apply -translate-y-1 opacity-0 pointer-events-none
    }
    .search-panel mark {
        @apply bg-transparent text-[var(--primary)]
    }

    .btn-card {
        @apply transition flex items-center justify-center bg-[var(--card-bg)] hover:bg-[var(--btn-card-bg-hover)]
        active:bg-[var(--btn-card-bg-active)]
    }
    .btn-card.disabled {
        @apply pointer-events-none text-black/10 dark:text-white/10
    }
    .btn-plain {
        @apply transition relative flex items-center justify-center bg-none
        text-black/75 hover:text-[var(--primary)] dark:text-white/75 dark:hover:text-[var(--primary)];
        &:not(.scale-animation) {
            @apply hover:bg-[var(--btn-plain-bg-hover)] active:bg-[var(--btn-plain-bg-active)]
        }
        &.scale-animation {
            @apply expand-animation;
            &.current-theme-btn {
                @apply before:scale-100 before:opacity-100 before:bg-[var(--btn-plain-bg-hover)] text-[var(--primary)]
            }
        }
    }
    .btn-regular {
        @apply transition flex items-center justify-center bg-[var(--btn-regular-bg)] hover:bg-[var(--btn-regular-bg-hover)] active:bg-[var(--btn-regular-bg-active)]
        text-[var(--btn-content)] dark:text-white/75
    }

    .link-underline {
        @apply transition underline decoration-2 decoration-dashed decoration-[var(--link-underline)]
        hover:decoration-[var(--link-hover)] active:decoration-[var(--link-active)] underline-offset-[0.25rem]
    }

    .toc-hide,
    .toc-not-ready {
        @apply opacity-0 pointer-events-none
    }

    #toc-inner-wrapper {
        mask-image: linear-gradient(to bottom, transparent 0%, black 2rem, black calc(100% - 2rem), transparent 100%);
    }

    .hide-scrollbar {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    .hide-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .text-90 {
        @apply text-black/90 dark:text-white/90
    }
    .text-75 {
        @apply text-black/75 dark:text-white/75
    }
    .text-50 {
        @apply text-black/50 dark:text-white/50
    }
    .text-30 {
        @apply text-black/30 dark:text-white/30
    }
    .text-25 {
        @apply text-black/25 dark:text-white/25
    }

    .meta-icon {
        @apply w-8 h-8 transition rounded-md flex items-center justify-center bg-[var(--btn-regular-bg)]
        text-[var(--btn-content)] mr-2
    }
    .with-divider {
        @apply before:content-['/'] before:ml-1.5 before:mr-1.5 before:text-[var(--meta-divider)] before:text-sm
        before:font-medium before:first-of-type:hidden before:transition
    }

    .btn-regular-dark {
        @apply flex items-center justify-center
        bg-[oklch(0.45_0.01_var(--hue))] hover:bg-[oklch(0.50_0.01_var(--hue))] active:bg-[oklch(0.55_0.01_var(--hue))]
        dark:bg-[oklch(0.30_0.02_var(--hue))] dark:hover:bg-[oklch(0.35_0.03_var(--hue))] dark:active:bg-[oklch(0.40_0.03_var(--hue))]
    }
    .btn-regular-dark.success {
        @apply bg-[oklch(0.75_0.14_var(--hue))] dark:bg-[oklch(0.75_0.14_var(--hue))]
    }

    /* ========================================
       Display Settings Panel Components
       ======================================== */
    
    /* Setting Section Title */
    .setting-section-title {
        @apply flex gap-2 font-bold text-lg text-neutral-900 dark:text-neutral-100 
               relative ml-3;
    }
    
    .setting-section-title::before {
        content: "";
        @apply w-1 h-4 rounded-md bg-[var(--primary)] 
               absolute -left-3 top-[0.33rem];
    }
    
    /* Toggle Switch */
    .toggle-switch {
        @apply relative w-12 h-6 rounded-full transition-colors duration-200 ease-in-out;
        cursor: pointer;
    }
    
    .toggle-switch.checked {
        @apply bg-[var(--primary)];
    }
    
    .toggle-switch.unchecked {
        @apply bg-[var(--btn-regular-bg)];
    }
    
    .toggle-switch-knob {
        @apply absolute left-1 top-1 w-4 h-4 rounded-full bg-white 
               transition-transform duration-200 ease-out;
    }
    
    .toggle-switch-knob.checked {
        transform: translateX(1.5rem);
    }
    
    .toggle-switch:active .toggle-switch-knob {
        @apply scale-90;
    }
    
    /* Slider Base */
    .slider-base {
        @apply w-full rounded-lg appearance-none cursor-pointer
               transition-all duration-150;
    }
    
    .slider-base:disabled {
        @apply opacity-50 cursor-not-allowed;
    }
    
    /* Slider Thumb - Unified Style */
    .slider-base::-webkit-slider-thumb {
        -webkit-appearance: none;
        @apply h-4 w-2 rounded-sm bg-white/70 
               hover:bg-white/80 active:bg-white/60
               transition-all duration-150;
    }
    
    .slider-base::-webkit-slider-thumb:hover {
        transform: scale(1.1);
    }
    
    .slider-base::-webkit-slider-thumb:active {
        transform: scale(0.95);
    }
    
    .slider-base::-moz-range-thumb {
        @apply h-4 w-2 rounded-sm bg-white/70 border-0
               hover:bg-white/80 active:bg-white/60
               transition-all duration-150;
    }
    
    .slider-base::-moz-range-thumb:hover {
        transform: scale(1.1);
    }
    
    .slider-base::-moz-range-thumb:active {
        transform: scale(0.95);
    }
    
    /* Color Slider (with rainbow gradient) */
    .slider-color {
        @apply h-6 px-1 rounded select-none;
        background-image: var(--color-selection-bar);
    }
    
    /* Default Slider (solid background) */
    .slider-default {
        @apply h-6 px-1 bg-[var(--btn-regular-bg)];
    }
    
    /* Value Badge */
    .setting-value-badge {
        @apply transition-all duration-200 bg-[var(--btn-regular-bg)] 
               w-10 h-7 rounded-md 
               flex justify-center font-bold text-sm items-center 
               text-[var(--btn-content)];
    }
    
    .setting-value-badge.updating {
        animation: badge-pulse 0.2s ease-in-out;
    }
    
    @keyframes badge-pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    /* Reset Button */
    .setting-reset-btn {
        @apply btn-regular w-7 h-7 rounded-md active:scale-90 
               will-change-transform transition-all duration-200;
    }
    
    .setting-reset-btn.hidden {
        @apply opacity-0 pointer-events-none;
    }
    
    .setting-reset-btn:not(.hidden) {
        animation: reset-btn-enter 0.3s ease-out;
    }
    
    @keyframes reset-btn-enter {
        from {
            opacity: 0;
            transform: rotate(-90deg) scale(0.8);
        }
        to {
            opacity: 1;
            transform: rotate(0) scale(1);
        }
    }
    
    .setting-reset-btn.small {
        @apply w-6 h-6;
    }
    
    .setting-reset-btn.small svg {
        @apply text-[0.75rem];
    }
    
    /* Expandable Section */
    .setting-expand-wrapper {
        @apply overflow-hidden;
    }
    
    .setting-expand-content {
        @apply transition-all duration-300 ease-in-out;
        max-height: 0;
        opacity: 0;
        padding-top: 0;
    }
    
    .setting-expand-content.expanded {
        max-height: 500px;
        opacity: 1;
        padding-top: 0.75rem;
    }
    
    /* Chevron Rotation */
    .setting-chevron {
        @apply text-[1.25rem] transition-transform duration-300;
    }
    
    .setting-chevron.expanded {
        transform: rotate(90deg);
    }
    
    /* Float Panel Enhanced Animation */
    .float-panel {
        transform-origin: top right;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .float-panel-closed {
        @apply -translate-y-2 opacity-0 pointer-events-none scale-95;
    }
}

.custom-md img, #post-cover img {
    @apply cursor-zoom-in
}

::selection {
    background-color: var(--selection-bg)
}

.dash-line {
    position: relative;
}

.dash-line::before {
    content: "";
    position: absolute;
    width: 10%;
    height: 100%;
    left: calc(50% - 1px);
    border-left: 2px dashed var(--line-color);
    pointer-events: none;
    transition: all 0.3s;
    transform: translateY(-50%);
}

.collapsed {
    height: var(--collapsedHeight);
}

.custom-md spoiler {
  @apply bg-[var(--codeblock-bg)] hover:bg-transparent px-1 py-0.5 overflow-hidden rounded-md transition-all duration-150;

  &:not(:hover) {
    color: var(--codeblock-bg);
    * {
        color: var(--codeblock-bg);
    }
  }
}

/* Global background image */
html::before {
  content: '';
  position: fixed;
  top: -20px;
  left: -20px;
  width: calc(100% + 40px);
  height: calc(100% + 40px);
  background-image: url('../assets/images/background.png');
  background-size: cover;
  background-position: center;
  filter: blur(var(--background-blur, 10px));
  -webkit-filter: blur(var(--background-blur, 10px));
  z-index: -1;
  display: var(--background-display, block);
}